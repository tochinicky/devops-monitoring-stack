global:
  resolve_timeout: 5m
  slack_api_url: "{{ slack_webhook_url }}"

route:
  group_by: [alertname, instance, job]
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  receiver: slack-notifications
  routes:
    - match:
        severity: critical
      receiver: slack-critical
    - match:
        severity: warning
      receiver: slack-warning

receivers:
  - name: 'slack-notifications'
    slack_configs:
      - send_resolved: true
        channel: '#devopsnotifications'
        title: '{{ if eq .Status "firing" }}üî¥ ALERT{{ else }}üü¢ RESOLVED{{ end }}: {{ .CommonLabels.alertname }}'
        text: |
          {{ if eq .Status "firing" }}*SYSTEM ALERT*{{ else }}*SYSTEM RECOVERED*{{ end }}

          {{ range .Alerts }}
          *{{ .Annotations.summary }}*
          {{ .Annotations.description }}

          *‚è∞ Incident Details:*
          ‚Ä¢ Started: {{ .StartsAt }}
          ‚Ä¢ Status: {{ .Status | toUpper }}

          *üîç Technical Information:*
          ‚Ä¢ System: {{ .Labels.instance }}
          ‚Ä¢ Job: {{ .Labels.job }}
          ‚Ä¢ Severity: {{ .Labels.severity }}

          *üë• Impact Assessment:*
          ‚Ä¢ Users affected: {{ if eq .Labels.job "blackbox_http" }}Website visitors{{ else }}Service users{{ end }}

          *üë• Team to Notify:* @devops-team
          {{ end }}
        icon_emoji: '{{ if eq .Status "firing" }}:red_circle:{{ else }}:green_circle:{{ end }}'

  - name: 'slack-critical'
    slack_configs:
      - send_resolved: true
        channel: '#devopsnotifications'
        title: '{{ if eq .Status "firing" }}üî¥ CRITICAL{{ else }}üü¢ RESOLVED{{ end }}: {{ .CommonLabels.alertname }}'
        text: |
          {{ if eq .Status "firing" }}*CRITICAL SYSTEM ALERT*{{ else }}*SYSTEM RECOVERED*{{ end }}

          {{ range .Alerts }}
          *{{ .Annotations.summary }}*
          {{ .Annotations.description }}

          *‚è∞ Incident Details:*
          ‚Ä¢ Started: {{ .StartsAt }}
          ‚Ä¢ Status: {{ .Status | toUpper }}

          *üîç Technical Information:*
          ‚Ä¢ System: {{ .Labels.instance }}
          ‚Ä¢ Job: {{ .Labels.job }}
          {{ if eq .Labels.job "blackbox_http" }}‚Ä¢ Error: Connection failed
          ‚Ä¢ HTTP Status: No response{{ end }}

          *üë• Impact Assessment:*
          ‚Ä¢ Severity: Critical
          ‚Ä¢ User Impact: {{ if eq .Labels.job "blackbox_http" }}All website users affected{{ else }}Service degradation{{ end }}

          *üö® Attention:* <@U08K2M1ERS5>
          {{ end }}
        icon_emoji: '{{ if eq .Status "firing" }}:fire:{{ else }}:white_check_mark:{{ end }}'
        link_names: true

  - name: 'slack-warning'
    slack_configs:
      - send_resolved: true
        channel: '#devopsnotifications'
        title: '{{ if eq .Status "firing" }}‚ö†Ô∏è WARNING{{ else }}üü¢ RESOLVED{{ end }}: {{ .CommonLabels.alertname }}'
        text: |
          {{ if eq .Status "firing" }}*WARNING ALERT*{{ else }}*WARNING RESOLVED*{{ end }}

          {{ range .Alerts }}
          *{{ .Annotations.summary }}*
          {{ .Annotations.description }}

          *‚è∞ Incident Details:*
          ‚Ä¢ Started: {{ .StartsAt }}
          ‚Ä¢ Status: {{ .Status | toUpper }}

          *üîç Technical Information:*
          ‚Ä¢ System: {{ .Labels.instance }}
          ‚Ä¢ Job: {{ .Labels.job }}
          {{ if eq .Labels.alertname "SlowResponseTime" }}‚Ä¢ Response Time: {{ if eq .Labels.job "blackbox_http" }}Slow{{ end }}{{ end }}
          {{ if eq .Labels.alertname "SSLCertExpiringSoon" }}‚Ä¢ Certificate Expires: Soon{{ end }}
          {{ if eq .Labels.alertname "HighCPULoad" }}‚Ä¢ CPU Load: High{{ end }}
          {{ if eq .Labels.alertname "HighMemoryLoad" }}‚Ä¢ Memory Use: High{{ end }}
          {{ if eq .Labels.alertname "HighDiskUsage" }}‚Ä¢ Disk Usage: High{{ end }}

          *üë• Impact Assessment:*
          ‚Ä¢ Severity: Warning
          ‚Ä¢ User Impact: Potential performance degradation

          *üí° Recommended Actions:*
          {{ if eq .Labels.alertname "SlowResponseTime" }}Check database queries or high backend resource usage.{{ else if eq .Labels.alertname "SSLCertExpiringSoon" }}Renew SSL certificate before expiration.{{ else if eq .Labels.alertname "HighCPULoad" }}Identify CPU-intensive processes and optimize.{{ else if eq .Labels.alertname "HighMemoryLoad" }}Check for memory leaks or increase available memory.{{ else if eq .Labels.alertname "HighDiskUsage" }}Clean up disk space or expand storage.{{ end }}

          *üö® Attention:* <@U08K2M1ERS5>
          {{ end }}
        icon_emoji: '{{ if eq .Status "firing" }}:warning:{{ else }}:white_check_mark:{{ end }}'
        link_names: true